<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<title>Mini Substitution Encryptor</title>
<style>
  body{font-family:Inter,system-ui,Segoe UI,Arial;max-width:720px;margin:28px auto;padding:20px}
  h1{font-size:20px;margin:0 0 8px}
  p.small{color:#555;margin:4px 0 16px;font-size:13px}
  textarea,input{width:100%;box-sizing:border-box;padding:10px;margin:8px 0;border:1px solid #ddd;border-radius:6px;font-size:15px}
  button{padding:10px 14px;margin:6px 4px 0 0;font-size:15px;border-radius:8px;border:0;background:#0b74ff;color:white;cursor:pointer}
  .row{display:flex;gap:8px}
  label{font-size:13px;color:#333}
  footer{margin-top:18px;color:#666;font-size:13px}
  .muted{color:#666;font-size:13px}
</style>
</head>
<body>
  <h1>Post-it Encryptor — Letters & Numbers Only</h1>
  <p class="small">Type your message, pick a key, click Encrypt. Ciphertext uses only letters, numbers, and spaces.</p>

  <label>Message / Ciphertext</label>
  <textarea id="msg" rows="3" placeholder="Type message here (or paste ciphertext to decrypt)"></textarea>

  <label>Key (your secret)</label>
  <input id="key" type="password" placeholder="e.g. mypass123">

  <div class="row">
    <button onclick="doEncrypt()">Encrypt → Cipher</button>
    <button onclick="doDecrypt()">Decrypt → Plain</button>
    <button onclick="clearAll()">Clear</button>
  </div>

  <p class="muted">Charset used: letters, numbers, and space only. Other characters are preserved as-is.</p>

  <footer>Good privacy, fast and tiny for Post-its.</footer>

<script>
// ALPHABET: letters (uppercase+lowercase), digits, and space
const ALPHABET = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789 ";

// helper: compute SHA-256 digest of key
async function sha256Bytes(str){
  const enc = new TextEncoder();
  const data = enc.encode(str);
  const hash = await crypto.subtle.digest('SHA-256', data);
  return new Uint8Array(hash);
}

// PRNG
function mulberry32(seed){
  return function(){
    let t = seed += 0x6D2B79F5;
    t = Math.imul(t ^ t >>> 15, t | 1);
    t ^= t + Math.imul(t ^ t >>> 7, t | 61);
    return ((t ^ t >>> 14) >>> 0) / 4294967296;
  }
}

// seeded shuffle
function seededShuffle(array, rnd){
  const a = array.slice();
  for(let i=a.length-1;i>0;i--){
    const r = Math.floor(rnd() * (i+1));
    const tmp = a[i]; a[i]=a[r]; a[r]=tmp;
  }
  return a;
}

// build substitution maps from key
async function buildMaps(key){
  const hash = await sha256Bytes(key || "");
  let seed = (hash[0]<<24) | (hash[1]<<16) | (hash[2]<<8) | (hash[3]);
  seed = seed >>> 0;
  const rnd = mulberry32(seed);
  const shuffled = seededShuffle(ALPHABET.split(''), rnd);
  const encMap = new Map();
  const decMap = new Map();
  for(let i=0;i<ALPHABET.length;i++){
    encMap.set(ALPHABET[i], shuffled[i]);
    decMap.set(shuffled[i], ALPHABET[i]);
  }
  return {encMap, decMap};
}

// encrypt
async function encryptText(plaintext, key){
  const {encMap} = await buildMaps(key);
  let out = "";
  for(const ch of plaintext){
    if(encMap.has(ch)){
      out += encMap.get(ch);
    } else {
      out += ch; // preserve unknown chars
    }
  }
  return out;
}

// decrypt
async function decryptText(ciphertext, key){
  const {decMap} = await buildMaps(key);
  let out = "";
  for(const ch of ciphertext){
    if(decMap.has(ch)){
      out += decMap.get(ch);
    } else {
      out += ch; // preserve unknown chars
    }
  }
  return out;
}

// UI
async function doEncrypt(){
  const msg = document.getElementById('msg').value;
  const key = document.getElementById('key').value || "";
  if(!msg){ alert("Enter a message to encrypt."); return; }
  const ct = await encryptText(msg, key);
  document.getElementById('msg').value = ct;
}
async function doDecrypt(){
  const ct = document.getElementById('msg').value;
  const key = document.getElementById('key').value || "";
  if(!ct){ alert("Paste ciphertext to decrypt."); return; }
  const pt = await decryptText(ct, key);
  document.getElementById('msg').value = pt;
}
function clearAll(){ document.getElementById('msg').value=''; document.getElementById('key').value=''; }
</script>
</body>
</html>
